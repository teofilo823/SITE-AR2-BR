<script>
    // --- CONFIGURA√á√ÉO MANUAL (A MAIS SEGURA) ---
    const CLIENT_ID = '1363856919638573277'; 
    
    // 1. COPIE O LINK DO SEU SITE QUE APARECE NO NAVEGADOR E COLE AQUI:
    const MEU_SITE_URL = 'https://teozin.github.io/ar2-ranked'; // Exemplo, ajuste para o seu!

    // 2. COPIE O LINK "RAW" DO SEU DATABASE.JSON DO GITHUB E COLE AQUI:
    const JSON_URL = 'https://raw.githubusercontent.com/teozin/ar2-ranked/main/database.json';

    const REDIRECT_URI = MEU_SITE_URL.replace(/\/$/, ""); 

    document.getElementById('login-link').href = `https://discord.com/api/oauth2/authorize?client_id=${CLIENT_ID}&redirect_uri=${encodeURIComponent(REDIRECT_URI)}&response_type=token&scope=identify`;

    window.onload = () => {
        const hash = new URLSearchParams(window.location.hash.slice(1));
        const token = hash.get('access_token');
        if (token) {
            window.history.replaceState({}, document.title, window.location.pathname);
            fetchUser(token);
        }
    };

    async function fetchUser(token) {
        try {
            const res = await fetch('https://discord.com/api/users/@me', { headers: { Authorization: `Bearer ${token}` } });
            const user = await res.json();
            document.getElementById('login-screen').style.display = 'none';
            document.getElementById('main-content').style.display = 'block';
            document.getElementById('user-display').innerHTML = `<img src="https://cdn.discordapp.com/avatars/${user.id}/${user.avatar}.png" onerror="this.src='https://cdn.discordapp.com/embed/avatars/0.png'"> <b>${user.username}</b>`;
            loadData(user.id);
        } catch (e) { console.error("Erro no login:", e); }
    }

    async function loadData(myId) {
        const body = document.getElementById('leaderboard-body');
        try {
            const res = await fetch(JSON_URL + '?nocache=' + new Date().getTime());
            if (!res.ok) throw new Error("N√£o encontrei o arquivo JSON");
            
            const data = await res.json();
            body.innerHTML = '';
            
            const users = data.users || {};
            const sorted = Object.entries(users).sort((a,b) => (b[1].trophies || 0) - (a[1].trophies || 0));

            if (sorted.length === 0) {
                body.innerHTML = '<tr><td colspan="4" style="text-align:center">O banco de dados est√° vazio ou sem jogadores.</td></tr>';
                return;
            }

            sorted.forEach(([id, u], i) => {
                const tr = document.createElement('tr');
                if (id === myId) tr.className = 'row-me';
                tr.innerHTML = `
                    <td>${i+1}</td>
                    <td style="color:var(--primary); font-weight:bold">${u.name || 'Jogador '+id.substring(0,4)}</td>
                    <td>${u.wins || 0}V / ${u.losses || 0}D</td>
                    <td style="color:var(--accent); font-weight:bold">${u.trophies || 0} üèÜ</td>
                `;
                body.appendChild(tr);
            });
        } catch (e) { 
            body.innerHTML = `<tr><td colspan="4" style="text-align:center; color:orange">Erro ao carregar dados. Verifique o link do JSON no c√≥digo.</td></tr>`;
        }
    }

    function logout() { window.location.href = MEU_SITE_URL; }
</script>
